---
title: "W12: Powietrze Wilgotne"
subtitle: "Psychrometria i Wykres Molliera"
author: "<span style='font-size: 1.5em;'>**dr hab. inż. prof. UPP Marek Urbaniak**</span>"
institute: |
  Wydział Inżynierii Środowiska i Inżynierii Mechanicznej<br><br>
  <div style="display: flex; justify-content: left; align-items: center; gap: 40px;">
    <img src="https://www.up.poznan.pl/sites/default/files/2024-10/logo_zielone_polskie_uklad_poziomy.png" style="height: 200px;">
    <img src="https://wisim.up.poznan.pl/sites/default/files/2023-02-13%2011%3A41/logo_wisim06.jpg" style="height: 200px;">
    <img src="img/KBiG.jpg" style="height: 200px;">
  </div>
lang: pl
format:
  revealjs:
    theme: ["theme/q-theme.scss"]
    include-in-header:
      text: |
        <style>
        body { background-color: #1a1a1a; }
        .reveal .slide-background-content {
            background-image: url("img/background_red.png") !important;
            background-size: contain !important; 
            background-repeat: no-repeat !important;
            background-position: center center !important;
            opacity: 0.2 !important;
        }
        .reveal .backgrounds .slide-background:nth-child(1) .slide-background-content {
            background-image: none !important;
            background-color: white !important;
            opacity: 1 !important;
        }
        </style>
    slide-number: c/t
    show-slide-number: all
    transition: slide
    chalkboard: true
    footer: "Termodynamika Techniczna (W12)"
    width: 1600
    height: 900
    margin: 0.2
    revealjs-plugins:
      - appearance
      - pointer
    pointer:
      color: "#e60000"
      pointerSize: 20
editor: source
---

## Agenda Wykładu {data-menu-title="Agenda"}

1.  **Skład Powietrza Wilgotnego** (Prawo Daltona)
2.  **Parametry Wilgotności** ($\varphi$, X)
3.  **Entalpia Powietrza Wilgotnego** ($h$)
4.  **Konstrukcja Wykresu Molliera h-X**
5.  **Przemiany Charakterystyczne**
6.  **Pomiary i Aparatura** (Psychrometry, Nawilżacze)
7.  **Bilans Masy i Energii**

---

## 1. Skład Powietrza Wilgotnego

::: {.callout-note appearance="simple" style="font-size: .9em;"}
**Powietrze wilgotne** to jednorodna mieszanina gazów zbliżonych do doskonałych ($N_2, O_2, Ar$) oraz **pary wodnej**.
:::

::: {.fragment .callout-important title="Prawo Daltona" style="font-size: .9em;"}
Ciśnienie całkowite (barometryczne) jest sumą ciśnień cząstkowych:
$$ p = p_g + p_p $$
Gdzie:

$p_g$ – ciśnienie cząstkowe powietrza suchego;    $p_p$ – ciśnienie cząstkowe pary wodnej.
:::

::: {.fragment style="font-size: .9em;"}
### Stan pary wodnej:

*   **Para przegrzana:** $p_p < p_{nasycenia}$ (Typowy stan w pomieszczeniu).
*   **Para nasycona:** $p_p = p_{nasycenia}$ ($RH = 100\%$).
*   **Mgła:** Powietrze przesycone (zawiera kropelki cieczy).
:::

---

## 2. Parametry Wilgotności{auto-animate=true auto-animate-easing="ease-in-out"}

Inżynierowie (i nie tylko) używają dwóch definicji wilgotności:

::: {.callout-tip title="Wilgotność Względna (Relative Humidity)"}
Określa, jak blisko jesteśmy stanu nasycenia (mgły).
$$ \varphi = \frac{p_p}{p_{sat}(T)} \cdot 100\% $$

::: {style="font-size: .7em;"}
*   $\varphi = 0\%$: Powietrze suche.
*   $\varphi = 100\%$: Punkt rosy (powietrze nasycone).
:::
:::

:::{.fragment .callout-note title="Wilgotność Bezwzględna" style="font-size: .9em;"}
Zdefiniowana jako stosunek masy pary wodnej do objętości powietrza.
$$ g = \frac{m_p}{V} = \frac{p_p}{R_p T} \quad [\frac{kg_{H2O}}{m^3}] $$
:::
---

## 2. Parametry Wilgotności{auto-animate=true auto-animate-easing="ease-in-out"}

::: {.callout-important title="Stopień Zawilżenia (Mixing Ratio)"}

Stosunek masy pary ($m_p$) do masy powietrza **suchego** ($m_g$).
$$ X = \frac{m_p}{m_g} = 0.622 \frac{p_p}{p - p_p} \quad [\frac{kg_{H2O}}{kg_{suchego}}] $$

*   **Kluczowe:** W procesach ogrzewania/chłodzenia masa suchego powietrza jest stała, więc **$X = const$** (jeśli nie nawilżamy).

:::

---

## 3. Entalpia ($h$)

::: {.callout-warning appearance="simple"}
Entalpia powietrza wilgotnego odniesiona jest do **1 kg powietrza suchego**.
:::

$$ h = h_{powietrza} + X \cdot h_{pary} $$

::: {.fragment .callout-note appearance="minimal"}
Przyjmując $0^\circ C$ jako punkt odniesienia:
$$ h = (1.005 \cdot T) + X \cdot (2501 + 1.86 \cdot T) \quad [\frac{kJ}{kg}] $$
:::

::: {.fragment}
**Składniki:**

1.  **1.005:** Ciepło właściwe powietrza suchego ($C_p$) $[kJ/(kg \cdot K)]$.
2.  **2501:** Ciepło parowania wody ($r$) w $0^\circ C$ $[kJ/kg]$.
3.  **1.86:** Ciepło właściwe pary wodnej $[kJ/(kg \cdot K)]$.
:::

---

## 4. Wykres Molliera h-X

Standard w Europie Środkowej. Układ **ukośnokątny** (rozciąga obszar nienasycony).

::: { }
*   **Oś pionowa:** Temperatura $t$ [°C].
:::
::: {.fragment .fade-in}
*   **Oś pozioma:** Stopień zawilżenia $X$ [g/kg].
:::
::: {.fragment .fade-in}
*   **Izentalpy ($h=const$):** Linie ukośne (biegną pod kątem ~135°, stąd "ukośność wykresu").
:::
::: {.fragment .fade-in}
*   **Krzywa graniczna ($\varphi=100\%$):** Oddziela obszar pary przegrzanej (góra) od obszaru mgły (dół).
:::

### Interpretacja Linii:{.fragment}
::: {.fragment}
1.  **Izotermy ($t$):** Lekko wznoszą się w prawo.
2.  **Krzywe $\varphi$:** Układają się "bananowo" nad krzywą graniczną.
:::

---

## Wizualizacja: Wykres h-X

```{r}
#| label: ix-diagram-all
#| echo: false
#| fig-align: center
#| fig-width: 14        # Duża szerokość "źródłowa" (w calach)
#| fig-height: 8        # Duża wysokość "źródłowa"
#| out-width: "100%"    # Rozciągnij do granic kontenera

library(ggplot2)
library(dplyr)

# --- 1. KONFIGURACJA I STAŁE ---
CONSTANTS <- list(
    p_atm = 1013.25,
    cp_dry = 1.005,
    cp_vap = 1.86,
    r_0 = 2501.0
)

# --- 2. FUNKCJE FIZYCZNE ---
get_psat <- function(t) {
    6.112 * exp((17.62 * t) / (243.12 + t))
}

get_x_from_rh <- function(t, rh, p = CONSTANTS$p_atm) {
    ps <- get_psat(t)
    pv <- rh * ps
    if (any(pv >= p)) {
        return(NA)
    }
    0.622 * pv / (p - pv)
}

get_t_from_h_x <- function(h, x_kg) {
    (h - x_kg * CONSTANTS$r_0) / (CONSTANTS$cp_dry + x_kg * CONSTANTS$cp_vap)
}

# --- 3. PRZYGOTOWANIE DANYCH ---
generate_mollier_data <- function() {
    x_max_g <- 45
    t_min <- -10
    t_max <- 55 # Górna granica wykresu

    # Stała transformacji wizualnej (wznios izoterm)
    vis_slope_val <- 0.08

    # Funkcja pomocnicza do transformacji
    transform_t <- function(t, x_g) {
        t + vis_slope_val * x_g
    }

    # A. Krzywe wilgotności (RH)
    t_seq <- seq(t_min, t_max, by = 0.5)
    # Zwiększamy zakres t_seq, bo przy transformacji t maleje w dół? Nie, t rośnie.
    # Musimy uważać na zakresy

    rh_levels <- c(0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0)

    df_rh <- expand.grid(t = t_seq, rh = rh_levels) %>%
        mutate(
            x_kg = get_x_from_rh(t, rh),
            x_g = x_kg * 1000,
            # Aplikujemy transformację wizualną do t
            t_vis = transform_t(t, x_g)
        ) %>%
        filter(!is.na(x_kg), x_g <= x_max_g) %>%
        # Nadpisujemy t, żeby ggplot używał t_vis, ale zachowujemy t_real
        mutate(t_real = t, t = t_vis) # Teraz t to t_vis

    # B. Linie Entalpii (Izentalpy)
    h_levels <- seq(0, 160, by = 10)
    x_seq_h <- seq(0, x_max_g, length.out = 200)

    df_h <- expand.grid(h_val = h_levels, x_g = x_seq_h) %>%
        mutate(
            x_kg = x_g / 1000,
            t_phys = get_t_from_h_x(h_val, x_kg),
            t = transform_t(t_phys, x_g) # t wizualne
        ) %>%
        filter(t >= t_min, t <= t_max + 10) # Szerszy zakres filtra

    # C. Przygotowanie etykiet entalpii
    h_labels <- df_h %>%
        group_by(h_val) %>%
        filter(x_g == max(x_g) | t == max(t)) %>%
        slice(1) %>%
        mutate(
            label_pos = ifelse(t >= t_max - 1, "top", "right")
        )

    # D. Izotermy (z załamaniem w punkcie nasycenia)
    t_iso_levels <- seq(-10, 55, by = 5)
    df_iso_list <- lapply(t_iso_levels, function(temp) {
        # 1. Punkt nasycenia
        x_sat_kg <- get_x_from_rh(temp, 1.0)
        # Jeśli NA (poza wykresem), to cała linia jest w obszarze pary przegrzanej lub mgły (teoretycznie)
        if (is.na(x_sat_kg)) x_sat_kg <- 100 # Duża wartość
        x_sat_g <- x_sat_kg * 1000

        # Segment 1: Przegrzana (lekko wznosząca się - cecha wykresu ukośnokątnego)
        s1_x_max <- min(x_sat_g, x_max_g)
        x_vals_s1 <- seq(0, s1_x_max, length.out = 10)

        # Tutaj t = temp + slope * x (transformacja)
        seg1 <- data.frame(
            x_g = x_vals_s1,
            t = transform_t(temp, x_vals_s1),
            group = paste0("t", temp, "_dry")
        )

        # Jeśli saturacja jest poza wykresem, zwracamy tylko segment 1
        if (x_sat_g >= x_max_g) {
            return(seg1)
        }

        # Segment 2: Mgła (spadek wzdłuż izentalpy)
        # Punkt Nasycenia (fizyczny) -> t = temp, x = x_sat_g
        # Punkt Nasycenia (wizualny) -> t_vis = temp + slope * x_sat_g
        # To jest ZAPEWNIONE przez transform_t(temp, x_vals_s1) na końcu s1.

        # Fizyczna entalpia w punkcie nasycenia
        h_sat <- CONSTANTS$cp_dry * temp + x_sat_kg * (CONSTANTS$r_0 + CONSTANTS$cp_vap * temp)

        # Zakres x we mgle
        x_fog_g <- seq(x_sat_g, x_max_g, length.out = 10)
        x_fog_kg <- x_fog_g / 1000

        # Fizyczna temperatura we mgle (dla h_vis = const)
        t_fog_phys <- (h_sat - x_fog_kg * CONSTANTS$r_0) / (CONSTANTS$cp_dry + x_fog_kg * CONSTANTS$cp_vap)

        # Wizualna temperatura we mgle (transformowana!)
        t_fog_vis <- transform_t(t_fog_phys, x_fog_g)

        seg2 <- data.frame(
            x_g = x_fog_g,
            t = t_fog_vis,
            group = paste0("t", temp, "_fog")
        )

        rbind(seg1, seg2)
    })
    df_iso <- do.call(rbind, df_iso_list)

    # E. Pęk Linii (Wykres tła - skala h_w) - "Biegun" w (0, 25 st. C)
    # Epsilon = (dh/dx) ~ cp * dt/dx + r0
    # Slope dt/dx_kg = (Epsilon - r0) / cp

    pole_x <- 0
    pole_y <- 25 # Przesunięty biegun

    # Lista wartości ze skrajnymi zakresami
    eps_values <- sort(unique(c(
        -1000, # Chłodzenie z osuszaniem
        seq(0, 1500, 500),
        seq(2000, 3200, 200),
        2500,
        seq(3500, 5000, 500),
        6000 # Czyste ogrzewanie
    )))

    fan_list <- lapply(eps_values, function(eps) {
        # Nachylenie fizyczne
        slope_phys_kg <- (eps - CONSTANTS$r_0) / CONSTANTS$cp_dry
        
        # Nachylenie wizualne (uwzględnia skrzywienie wykresu)
        # slope_vis = slope_phys + vis_slope
        # vis_slope_val jest w [deg/g], wiec *1000 aby miec [deg/kg]
        slope_vis_kg <- slope_phys_kg + vis_slope_val * 1000
        
        # Równanie linii wizualnej: y_vis = pole_y + slope_vis_kg * x_kg
        # gdzie x_kg in [0, 0.045], y_vis in [-10, 55]
        
        x1 <- 0; y1 <- 0; side <- "none"
        
        # 1. Sprawdzamy prawą ścianę (x_max)
        x_right_kg <- x_max_g / 1000
        y_at_right <- pole_y + slope_vis_kg * x_right_kg
        
        if (y_at_right <= t_max && y_at_right >= t_min) {
            # Trafia w prawą krawędź wizualną
            x1 <- x_max_g
            y1 <- y_at_right
            side <- "right"
        } else {
            # 2. Trafia w górę lub dół
            if (slope_vis_kg > 0) {
                 # Góra (y_vis = 55)
                 x_top_kg <- (t_max - pole_y) / slope_vis_kg
                 x1 <- x_top_kg * 1000
                 y1 <- t_max
                 side <- "top"
            } else {
                 # Dół (y_vis = -10)
                 x_bot_kg <- (t_min - pole_y) / slope_vis_kg
                 x1 <- x_bot_kg * 1000
                 y1 <- t_min
                 side <- "bottom"
            }
        }
        
        # Zabezpieczenie zakresów
        if (x1 > x_max_g) x1 <- x_max_g 
        if (x1 < 0) x1 <- 0
        
        # Kąt rotacji (bazujemy na wizualnym nachyleniu)
        # Vis slope na wykresie (jednostki osi: 1 st C / 1 g)
        # slope_vis_kg to [deg/kg]. slope_vis_g = slope_vis_kg / 1000
        vis_slope_plot <- slope_vis_kg / 1000
        
        # Uwzględniamy coord_fixed(ratio = 0.5)
        angle <- atan(0.5 * vis_slope_plot) * 180 / pi
        
        # Pozycjonowanie etykiety
        factor <- 0.92
        lab_x <- pole_x + (x1 - pole_x) * factor
        lab_y <- pole_y + (y1 - pole_y) * factor
        
        data.frame(x0=pole_x, y0=pole_y, x1=x1, y1=y1, eps=eps, side=side, lab_x=lab_x, lab_y=lab_y, angle=angle)
    })
    df_fan <- do.call(rbind, fan_list)

    list(rh = df_rh, h_lines = df_h, h_labels = h_labels, isotherms = df_iso, fan = df_fan)
}

data <- generate_mollier_data()

# --- 4. RYSOWANIE ---

p <- ggplot() +

    # 0. TŁO - PĘK LINII (Skala Randa) dla epsilon
    geom_segment(
        data = data$fan,
        aes(x = x0, y = y0, xend = x1, yend = y1),
        color = "gray60", size = 0.5, linetype = "longdash"
    ) +
    geom_text(
        data = data$fan,
        aes(x = lab_x, y = lab_y, label = eps, angle = angle),
        hjust = 0.5, vjust = -0.3,
        size = 3.2, color = "gray60", fontface = "bold"
    ) +
    # Opis jednostki skali Randa
    annotate("text", x = 35, y = 53, label = "[\u0394h/\u0394X kJ/kg]", color = "gray60", size = 5.5, fontface = "italic", hjust = 1) +

    # 1. LINIE ENTALPII
    geom_line(
        data = data$h_lines, aes(x = x_g, y = t, group = h_val),
        color = "darkgreen", size = 1, linetype = "dotted"
    ) +

    # Etykiety Entalpii (Inteligentne pozycjonowanie)
    geom_text(
        data = data$h_labels,
        aes(x = x_g, y = t, label = h_val, hjust = ifelse(label_pos == "top", 0.5, 0)),
        vjust = -0.5,
        nudge_x = 0.5,
        size = 5, color = "darkgreen", fontface = "italic"
    ) +

    # 2. IZOTERMY (Custom Grid)
    geom_line(
        data = data$isotherms,
        aes(x = x_g, y = t, group = group),
        color = "orange", size = 0.9, linetype = "solid", alpha = 0.6
    ) +

    # 3. KRZYWE WILGOTNOŚCI
    geom_line(
        data = data$rh, aes(x = x_g, y = t, group = rh, color = factor(rh)),
        size = 0.8
    ) +
    geom_line(
        data = data$rh %>% filter(rh == 1.0),
        aes(x = x_g, y = t), color = "darkblue", size = 1.2
    ) +

    # Etykiety RH (ZMNIEJSZONE do 4, Kolor dopasowany do linii)
    geom_text(
        data = data$rh %>% filter(t > 25) %>% group_by(rh) %>% slice(round(n() / 2)),
        aes(x = x_g, y = t, label = paste0(rh * 100, "%"), color = factor(rh)),
        size = 4, fontface = "bold", vjust = -0.4,
        show.legend = FALSE
    ) +
    # 4. STYL I KOLORY
    scale_color_viridis_d(option = "C", direction = -1) +
    scale_x_continuous(expand = c(0, 0), limits = c(0, 45), breaks = seq(0, 45, 5)) +
    scale_y_continuous(expand = c(0, 0), limits = c(-10, 55), breaks = seq(-10, 55, 5)) +
    labs(
        title = "Wykres h-X (Molliera)",
        subtitle = NULL, # Usunąłem podtytuł, by zyskać miejsce
        x = "Stopień zwilżenia X [g/kg]",
        y = "Temperatura [°C]"
    ) +
    theme_bw(base_size = 22) + # Duża czcionka bazowa

    theme(
        # Marginesy: Góra, Prawa, Dół, Lewa (Zmniejszone, bo etykiety są wewnątrz)
        plot.margin = margin(t = 0.5, r = 0.5, b = 0.5, l = 0.5, "cm"),

        # Izotermy (Custom) i Oś Y (Pomarańczowe)
        panel.grid.major.y = element_blank(), # Wyłączamy standardową siatkę Y, bo mamy własne izotermy
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_line(color = "gray90"),
        axis.text.y = element_text(color = "orange", face = "bold"),
        axis.title.y = element_text(color = "orange", face = "bold"),
        axis.ticks.y = element_line(color = "orange"),

        # Tytuł
        plot.title = element_text(size = 18, face = "bold"),
        legend.position = "none"
    ) +

    # Clip = "off" pozwala pisać po marginesach
    coord_fixed(ratio = 0.5, clip = "off")

print(p)
```

---

## 5. Przemiany Charakterystyczne{auto-animate=true auto-animate-easing="ease-in-out"}

::: {.callout-warning title="1. Ogrzewanie Izobaryczne (X=const)" style="font-size: .9em;"}
*   **Proces:** Nagrzewnica.
*   **Wykres:** Pionowo do góry.
*   **Efekt:** Temperatura rośnie, **wilgotność względna $\varphi$ maleje** (powietrze "schnie").
:::

::: {.fragment .callout-tip title="2. Ochładzanie (X=const)" style="font-size: .9em;"}
*   **Proces:** Chłodnica (powyżej punktu rosy).
*   **Wykres:** Pionowo w dół.
*   **Efekt:** $\varphi$ rośnie aż do 100% (Punkt Rosy $t_r$).
:::

::: {.fragment .callout-note title="3. Suszenie (h=const)" style="font-size: .9em;"}
*   **Proces:** Nawilżanie adiabatyczne (kontakt z wodą).
*   **Wykres:** Skośnie w dół (w stronę wyższego X).
*   **Efekt:** Powietrze się nawilża i ochładza (energia zostaje w układzie).
:::

--- 

## 5. Przemiany Charakterystyczne{auto-animate=true auto-animate-easing="ease-in-out"}

```{r}
#| label: ix-diagram-advanced
#| echo: false
#| fig-align: center
#| fig-width: 14        # Duża szerokość "źródłowa" (w calach)
#| fig-height: 8        # Duża wysokość "źródłowa"
#| out-width: "100%"    # Rozciągnij do granic kontenera

library(ggplot2)

# ===== FUNKCJE POMOCNICZE (fizyka powietrza wilgotnego) =====

# Ciśnienie nasycenia pary wodnej (Magnus formula)
p_sat <- function(t) {
    # t w °C, wynik w kPa
    0.61121 * exp((18.678 - t / 234.5) * (t / (257.14 + t)))
}

# Stopień zawilżenia dla danej temp i wilgotności względnej
x_calc <- function(t, phi, p_atm = 101.325) {
    # phi w %, p_atm w kPa
    p_p <- (phi / 100) * p_sat(t)
    622 * p_p / (p_atm - p_p) # g/kg
}

# Entalpia właściwa [kJ/kg] (h = cp*t + x*(r0 + cpv*t))
h_calc <- function(t, x) {
    1.005 * t + (x / 1000) * (2501 + 1.86 * t)
}

# ===== GENEROWANIE SIATKI WYKRESU =====

# Krzywa nasycenia (phi = 100%)
t_range <- seq(-5, 50, 0.5)
x_sat <- sapply(t_range, function(t) x_calc(t, 100))
df_sat <- data.frame(t = t_range, x = x_sat)
df_sat <- df_sat[df_sat$x < 30, ]

# Linie stałej wilgotności względnej (phi = const)
phi_levels <- c(20, 40, 60, 80)
df_phi <- do.call(rbind, lapply(phi_levels, function(phi) {
    t_vals <- seq(0, 45, 1)
    x_vals <- sapply(t_vals, function(t) x_calc(t, phi))
    data.frame(t = t_vals, x = x_vals, phi = phi)
}))
df_phi <- df_phi[df_phi$x < 30 & df_phi$x > 0, ]

# Izotermy (t = const) - z załamaniem na linii saturacji
temp_levels <- seq(5, 45, 5)
df_iso_t <- do.call(rbind, lapply(temp_levels, function(temp) {
    # Punkt saturacji dla danej temperatury
    x_sat <- x_calc(temp, 100)

    # Segment 1: Obszar pary przegrzanej (poziomy, od x=0 do x_sat)
    segment1 <- data.frame(
        t = temp,
        x = seq(0, x_sat, length.out = 30),
        temp_label = temp,
        segment = "przegrzana"
    )

    # Segment 2: Obszar mgły (izotermy równoległe do izentalp)
    # W obszarze mgły na wykresie h-X izotermy biegną niemal równolegle do izentalp.
    # Obliczamy "entalpię nasycenia" w punkcie załamania, używając tych samych współczynników co przy rysowaniu izentalp.
    h_sat_approx <- 1.005 * temp + x_sat * (2.5 + 0.00186 * temp)

    x_max_fog <- min(x_sat + 5, 30) # Zasięg we mgle
    x_fog <- seq(x_sat, x_max_fog, length.out = 20)

    # Wyznaczamy przebieg temperatury dla stałej entalpii (pseudo-izoterma we mgle)
    t_fog <- (h_sat_approx - 2.5 * x_fog) / (1.005 + 0.00186 * x_fog)

    segment2 <- data.frame(
        t = t_fog,
        x = x_fog,
        temp_label = temp,
        segment = "mgla"
    )

    rbind(segment1, segment2)
}))

# Izentalpy (h = const)
h_levels <- seq(20, 100, 20)
df_isenth <- do.call(rbind, lapply(h_levels, function(h_val) {
    # Dla danej entalpii h, mamy: t = (h - 2.5*x) / (1 + 0.00186*x) (przybliżenie)
    x_vals <- seq(0, 25, 0.5)
    t_vals <- (h_val - 2.5 * x_vals) / (1.005 + 0.00186 * x_vals)
    df_temp <- data.frame(t = t_vals, x = x_vals, h = h_val)
    # Ogranicz do obszaru fizycznego
    df_temp <- df_temp[df_temp$t >= -10 & df_temp$t <= 50 & df_temp$x >= 0 & df_temp$x <= 25, ]
    df_temp
}))

# ===== PRZEMIANY CHARAKTERYSTYCZNE =====

# Punkt początkowy: t0=20°C, phi0=50%
t0 <- 20
phi0 <- 50
x0 <- x_calc(t0, phi0)
h0 <- h_calc(t0, x0)

# 1. OGRZEWANIE (X=const, w górę)
t1_heat <- 35 # Ogrzanie do 35°C
x1_heat <- x0 # X stałe!
h1_heat <- h_calc(t1_heat, x1_heat)
heating <- data.frame(
    t = seq(t0, t1_heat, length.out = 20),
    x = x0
)

# 2. OCHŁADZANIE (X=const, w dół do punktu rosy)
# Punkt rosy: temp przy której phi=100% dla danego X
t_dew <- uniroot(function(t) x_calc(t, 100) - x0, interval = c(-10, t0))$root
cooling <- data.frame(
    t = seq(t0, t_dew, length.out = 20),
    x = x0
)

# 3. NAWILŻANIE ADIABATYCZNE (h=const, ukośnie w dół-prawo)
# Dla h=const: nawilżamy wodą, temp spada, x rośnie
x_humid_max <- min(x0 + 6, x_calc(15, 99)) # Kończymy przy niższej temp
df_humid_temp <- data.frame(x = seq(x0, x_humid_max, length.out = 30))
df_humid_temp$t <- (h0 - 2.5 * df_humid_temp$x) / (1.005 + 0.00186 * df_humid_temp$x)
humidification <- df_humid_temp[df_humid_temp$t >= 10, ]

# ===== WYKRES =====
ggplot() +
    # Krzywa nasycenia
    geom_line(data = df_sat, aes(x = x, y = t), color = "#0066cc", linewidth = 2) +
    annotate("text",
        x = max(df_sat$x) - 10, y = max(df_sat$t) + 2,
        label = "φ = 100% (Nasycenie)", color = "#0066cc", fontface = "bold", size = 8
    ) +

    # Linie stałej wilgotności względnej
    geom_line(
        data = df_phi, aes(x = x, y = t, group = phi),
        color = "#66b3ff", linetype = "dotted", linewidth = 1.6, alpha = 0.7
    ) +

    # Izotermy
    geom_line(
        data = df_iso_t, aes(x = x, y = t, group = temp_label),
        color = "#cc0000", linetype = "dashed", linewidth = 1.0, alpha = 0.5
    ) +

    # Izentalpy
    geom_line(
        data = df_isenth, aes(x = x, y = t, group = h),
        color = "#009900", linetype = "dotdash", linewidth = 1.6, alpha = 0.6
    ) +

    # === PRZEMIANY ===

    # Ogrzewanie (czerwona strzałka w górę)
    geom_path(
        data = heating, aes(x = x, y = t),
        color = "#ff3300", linewidth = 3, arrow = arrow(length = unit(0.3, "cm"), type = "closed")
    ) +
    annotate("text",
        x = x0 + .5, y = (t0 + t1_heat * 1.2) / 2,
        label = "1. Ogrzewanie\n(X=const)", color = "#ff3300", fontface = "bold", size = 8, hjust = 0
    ) +

    # Ochładzanie (niebieska strzałka w dół)
    geom_path(
        data = cooling, aes(x = x, y = t),
        color = "#0033cc", linewidth = 3, arrow = arrow(length = unit(0.3, "cm"), type = "closed")
    ) +
    annotate("text",
        x = x0 - 1, y = (t0 + t_dew) / 2,
        label = "2. Ochładzanie\n(X=const)", color = "#0033cc", fontface = "bold", size = 8, hjust = 1
    ) +

    # Nawilżanie adiabatyczne (zielona strzałka ukośna)
    geom_path(
        data = humidification, aes(x = x, y = t),
        color = "#00aa00", linewidth = 3, arrow = arrow(length = unit(0.3, "cm"), type = "closed")
    ) +
    annotate("text",
        x = (x0 + x_humid_max + 1) / 2 + 2, y = humidification$t[10] + 5,
        label = "3. Nawilżanie\nadiabatyczne (h=const)", color = "#00aa00", fontface = "bold", size = 8
    ) +

    # Punkt początkowy
    geom_point(aes(x = x0, y = t0), size = 5, color = "black", shape = 21, fill = "yellow", stroke = 2) +
    annotate("text",
        x = x0 - .3, y = t0 + 3, label = sprintf("Start\n(%.1f°C, %.0f%%)", t0, phi0),
        fontface = "bold", size = 8, hjust = 1
    ) +

    # Opisy
    labs(
        title = "Wykres Molliera h-X dla Powietrza Wilgotnego",
        subtitle = "Z naniesionymi kluczowymi przemianami termodynamicznymi",
        x = "Stopień zawilżenia X [g/kg suchego powietrza]",
        y = "Temperatura t [°C]"
    ) +
    theme_minimal(base_size = 13) +
    theme(
        plot.title = element_text(face = "bold", size = 16),
        axis.text = element_text(size = 26), # 2x większe etykiety osi (było 13)
        axis.title = element_text(size = 28), # 2x większe tytuły osi
        panel.grid.minor = element_line(color = "gray90", linewidth = 0.3),
        panel.grid.major = element_line(color = "gray80", linewidth = 0.5)
    ) +
    coord_cartesian(xlim = c(0, 25), ylim = c(0, 50)) +
    scale_x_continuous(breaks = seq(0, 25, 5)) +
    scale_y_continuous(breaks = seq(0, 50, 5))
```

---

## 6. Pomiar Parametrów Powietrza

::: {.columns}
::: {.column width="50%"}
### Psychrometr Augusta/Assmana
Dwa termometry:

1.  **Suchy ($t$):** Mierzy temp. powietrza.
2.  **Zwilżony ($t_m$):** Owinięty wilgotną tkaniną. Woda parując, chłodzi termometr.

*   **Zasada:** Im suchsze powietrze, tym intensywniejsze parowanie i niższa $t_m$.
*   Różnica psychrometryczna $(t - t_m)$ pozwala odczytać $\varphi$.
:::

::: {.column width="50%"}
### Higrometry

::: {.fragment}
*   **Włosowe:** (Historyczne) Włos ludzki wydłuża się pod wpływem wilgoci.
*   **Pojemnościowe:** Zmiana stałej dielektrycznej polimeru.
*   **Punktu rosy:** Lusterko schładzane aż do pojawienia się rosy.
:::
:::
:::

---

## Aparaty i Zastosowania

::: {}
### Urządzenia (AHU - Air Handling Unit)
*   **Nawilżacze:** Parowe (higieniczne), Zraszane (adiabatyczne - chłodzą!).
*   **Osuszacze:** Chłodnicze (wykraplanie), Adsorpcyjne (rotor z żelem krzemionkowym).
*   **Wymienniki:** Nagrzewnice i chłodnice.
:::

::: {.fragment}
### Zastosowania
*   **Klimatyzacja komfortu:** $t \approx 20-24^\circ C$, $\varphi \approx 40-60\%$.
*   **Technologia:** Przemysł papierniczy, tekstylny, spożywczy (suszarnie), pomieszczenia czyste (elektronika).
*   **Wentylacja:** Usuwanie zanieczyszczeń i wilgoci.
*   **Medycyna / Ochrona zdrowia:** sale operacyjne, inkubatory, sterylizacja.
:::

::: {.fragment .absolute top=0% left=20% width=70% style="box-shadow: 0 0 20px rgba(0,0,0,0.5); z-index: 10;"}
![](img/Small-Air-Handling-Units-SENV-1591216654.jpg)
::: 

---

## 7. Bilans Masy i Energii

Dla mieszania dwóch strumieni powietrza (1 i 2) obwiązują zasady zachowania:

::: {.callout-important title="Równanie Ciągłości (Bilans Masy Wilgoci)"}
$$ \dot{m}_{g1} \cdot X_1 + \dot{m}_{g2} \cdot X_2 = \dot{m}_{g3} \cdot X_3 $$
Masa pary wodnej w strumieniu wynikowym jest sumą mas cząstkowych.
:::

::: {.fragment .callout-note title="Bilans Entalpii (Bilans Energii)"}
$$ \dot{m}_{g1} \cdot h_1 + \dot{m}_{g2} \cdot h_2 = \dot{m}_{g3} \cdot h_3 $$
Energia całkowita układu zostaje zachowana (proces adiabatyczny).
:::

---

## Przykłady Obliczeniowe

::: {.callout-note title="Zadanie 1: Ogrzewanie Powietrza"}
**Dane:** Powietrze $t_1=25^\circ C$, $\varphi_1=50\%$ ogrzewamy do $t_2=35^\circ C$.

1.  Z tablic $p_s(25) = 3.17$ kPa $\rightarrow p_p = 0.5 \cdot 3.17 = 1.585$ kPa.
2.  Ponieważ $X=const$, to $p_p$ się nie zmienia!
3.  Z tablic $p_s(35) = 5.63$ kPa.
4.  Nowa wilgotność: $\varphi_2 = \frac{1.585}{5.63} \approx 28.2\%$.
**Wniosek:** Ogrzewanie silnie wysusza powietrze (względnie).
:::

::: {.fragment .callout-tip title="Zadanie 2: Parametry Powietrza"}
**Dane:** $p=110$ kPa, $t=30^\circ C$, $\varphi=60\%$.
*   $p_s=4.24$ kPa $\rightarrow p_p = 2.54$ kPa.
*   $X = 0.622 \frac{2.54}{110-2.54} \approx 14.7$ g/kg.
:::

---

## Współczynnik Kierunkowy Przemiany ($\varepsilon$)

::: {.callout-important title="Definicja" appearance="simple"}
**Współczynnik kierunkowy** $\varepsilon$ określa nachylenie wektora przemiany na wykresie h-X:
$$ \varepsilon = \frac{\Delta h}{\Delta X} \quad \left[\frac{\text{kJ}}{\text{kg}_{H_2O}}\right] $$
:::

::: {.columns}
::: {.column width="50%"}
**Interpretacja fizyczna:**

$\varepsilon$ odpowiada **entalpii właściwej medium** dodawanego do powietrza ($h_w$).

::: {.fragment}
| Medium | $h_w$ | $\varepsilon$ | Kierunek |
|--------|-------|---------------|----------|
| Woda ciekła (~20°C) | ~84 kJ/kg | ≈ 0 | wzdłuż izentalpy |
| Para nasycona | ~2500 kJ/kg | ≈ 2500 | prawie poziomo |
| Czyste ciepło | ∞ | ∞ | pionowo |
:::
:::
::: {.column width="50%"}
::: {.fragment}
**Bilans energii:**
$$ \dot{m}_g (h_2 - h_1) = \dot{m}_w \cdot h_w $$

**Stąd:**
$$ \varepsilon = \frac{h_2 - h_1}{X_2 - X_1} = h_w $$
:::

::: {.fragment .callout-tip title="Skala Randa" style="font-size: 0.85em;"}
Na wykresie Molliera linie o stałym $\varepsilon$ tworzą **pęk promieni** z "bieguna" — to właśnie **skala Randa** widoczna na głównym wykresie h-X.
:::
:::
:::

---

## Przemiana 1: Mieszanie Strumieni Powietrza

::: {.callout-note title="Zasada" appearance="simple" style="font-size: 0.85em;"}
Stan wynikowy (M) leży **na odcinku 1-2**. Położenie zależy od stosunku masowego: $\frac{\overline{1M}}{\overline{M2}} = \frac{\dot{m}_{g,2}}{\dot{m}_{g,1}}$
:::

::: {.columns}
::: {.column width="35%"}
**Bilansy:**

$$ X_M = \frac{\dot{m}_1 X_1 + \dot{m}_2 X_2}{\dot{m}_1 + \dot{m}_2} $$

$$ h_M = \frac{\dot{m}_1 h_1 + \dot{m}_2 h_2}{\dot{m}_1 + \dot{m}_2} $$

::: {.fragment .callout-tip title="Zastosowania" style="font-size: 0.7em;"}
**Rekuperacja:** Odzysk ciepła w centralach wentylacyjnych. **Klimatyzacja:** Mieszanie powietrza świeżego z recyrkulowanym. **Wentylacja:** Rozcieńczanie zanieczyszczeń.
:::
:::
::: {.column width="65%"}
```{r}
#| label: mix-two-streams
#| echo: false
#| fig-width: 9
#| fig-height: 7
#| fig-align: center

# Stałe i funkcje
vis_slope <- 0.08
transform_vis <- function(t, x) t + vis_slope * x

# Punkty stanu
p1 <- list(x = 5, t = 15)
p2 <- list(x = 12, t = 35)
r <- 0.6
pM <- list(x = r*p1$x + (1-r)*p2$x, t = r*p1$t + (1-r)*p2$t)

p1v <- list(x = p1$x, t = transform_vis(p1$t, p1$x))
p2v <- list(x = p2$x, t = transform_vis(p2$t, p2$x))
pMv <- list(x = pM$x, t = transform_vis(pM$t, pM$x))

# Krzywe RH
rh_levels <- c(0.4, 0.6, 0.8, 1.0)
t_seq <- seq(5, 45, by = 0.5)
df_rh <- do.call(rbind, lapply(rh_levels, function(rh) {
    x_kg <- sapply(t_seq, function(t) get_x_from_rh(t, rh))
    data.frame(t = t_seq, x_g = x_kg * 1000, rh = rh) %>% 
        filter(!is.na(x_g), x_g <= 25) %>%
        mutate(t_vis = transform_vis(t, x_g))
}))

ggplot() +
    # Krzywe RH
    geom_line(data = df_rh, aes(x = x_g, y = t_vis, group = rh, color = factor(rh)), size = 1) +
    scale_color_viridis_d(option = "C", direction = -1, name = "φ") +
    # Linia mieszania
    geom_segment(aes(x = p1v$x, y = p1v$t, xend = p2v$x, yend = p2v$t),
                 color = "purple", size = 2, linetype = "dashed") +
    # Punkty
    geom_point(aes(x = p1v$x, y = p1v$t), color = "blue", size = 8) +
    geom_point(aes(x = p2v$x, y = p2v$t), color = "red", size = 8) +
    geom_point(aes(x = pMv$x, y = pMv$t), color = "green4", size = 10, shape = 18) +
    # Etykiety
    annotate("text", x = p1v$x, y = p1v$t + 4, label = "1", color = "blue", size = 10, fontface = "bold") +
    annotate("text", x = p2v$x, y = p2v$t + 4, label = "2", color = "red", size = 10, fontface = "bold") +
    annotate("text", x = pMv$x + 2, y = pMv$t - 3, label = "M", color = "green4", size = 10, fontface = "bold") +
    # Osie
    scale_x_continuous(limits = c(0, 25), breaks = seq(0, 25, 5)) +
    scale_y_continuous(limits = c(10, 50), breaks = seq(10, 50, 5)) +
    labs(x = "X [g/kg]", y = "t [°C]") +
    theme_minimal(base_size = 22) +
    theme(legend.position = "right") +
    coord_fixed(ratio = 0.5)
```
:::
:::



---

## Przemiana 2: Nawilżanie Parą Wodną

::: {.callout-note title="Zasada" appearance="simple" style="font-size: 0.85em;"}
Przy nawilżaniu **parą** ($h_w \approx 2500$ kJ/kg) przemiana biegnie **prawie poziomo** (wzdłuż izotermy). $\varepsilon = h_w \approx 2500$ kJ/kg.
:::

::: {.columns}
::: {.column width="35%"}
**Bilansy:**

$$ \Delta X = \frac{\dot{m}_p}{\dot{m}_g} $$

$$ \Delta h = h_w \cdot \Delta X $$

::: {.fragment}
Temperatura prawie stała!
:::
::: {.fragment .callout-tip title="Zastosowania" style="font-size: 0.7em;"}
**Klimatyzacja zimowa:** Nawilżanie pomieszczeń ogrzewanych. **Przemysł tekstylny:** Utrzymanie wilgotności włókien. **Drukarnie:** Zapobieganie elektryzowaniu papieru.
:::
:::
::: {.column width="65%"}
```{r}
#| label: steam-humidification
#| echo: false
#| fig-width: 9
#| fig-height: 7
#| fig-align: center

# Stan początkowy i końcowy
p1 <- list(x = 5, t = 25)
p2 <- list(x = 18, t = 25.8)

p1v <- list(x = p1$x, t = transform_vis(p1$t, p1$x))
p2v <- list(x = p2$x, t = transform_vis(p2$t, p2$x))

# Krzywe RH
rh_levels <- c(0.4, 0.6, 0.8, 1.0)
t_seq <- seq(10, 45, by = 0.5)
df_rh <- do.call(rbind, lapply(rh_levels, function(rh) {
    x_kg <- sapply(t_seq, function(t) get_x_from_rh(t, rh))
    data.frame(t = t_seq, x_g = x_kg * 1000, rh = rh) %>% 
        filter(!is.na(x_g), x_g <= 30) %>%
        mutate(t_vis = transform_vis(t, x_g))
}))

# Izoterma t=25
iso_t <- 25
iso_x <- seq(0, 25, by = 1)
df_iso <- data.frame(x_g = iso_x, t_vis = transform_vis(iso_t, iso_x))

ggplot() +
    # Izoterma
    geom_line(data = df_iso, aes(x = x_g, y = t_vis), color = "orange", size = 1.2, linetype = "dotted") +
    annotate("text", x = 22, y = transform_vis(iso_t, 22) + 2, label = "t = 25°C", color = "orange", size = 6) +
    # Krzywe RH
    geom_line(data = df_rh, aes(x = x_g, y = t_vis, group = rh, color = factor(rh)), size = 1) +
    scale_color_viridis_d(option = "C", direction = -1, name = "φ") +
    # Strzałka przemiany
    geom_segment(aes(x = p1v$x, y = p1v$t, xend = p2v$x, yend = p2v$t),
                 arrow = arrow(length = unit(0.5, "cm")),
                 color = "darkgreen", size = 2) +
    # Punkty
    geom_point(aes(x = p1v$x, y = p1v$t), color = "blue", size = 8) +
    geom_point(aes(x = p2v$x, y = p2v$t), color = "green4", size = 8) +
    # Etykiety
    annotate("text", x = p1v$x, y = p1v$t + 4, label = "1", color = "blue", size = 10, fontface = "bold") +
    annotate("text", x = p2v$x, y = p2v$t + 4, label = "2", color = "green4", size = 10, fontface = "bold") +
    # Osie
    scale_x_continuous(limits = c(0, 30), breaks = seq(0, 30, 5)) +
    scale_y_continuous(limits = c(15, 45), breaks = seq(15, 45, 5)) +
    labs(x = "X [g/kg]", y = "t [°C]") +
    theme_minimal(base_size = 22) +
    theme(legend.position = "right") +
    coord_fixed(ratio = 0.5)
```
:::
:::



---

## Przemiana 3: Cykl Suszarniczy

::: {.callout-note title="Zasada" appearance="simple" style="font-size: 0.85em;"}
**(A)** Podgrzanie powietrza ($X=const$, pionowo). **(B)** Suszenie materiału ($h \approx const$, wzdłuż izentalpy).
:::

::: {.columns}
::: {.column width="35%"}
**Etap A:** $X_A = X_0$, $t \uparrow$

**Etap B:** $h_B \approx h_A$, $X \uparrow$, $t \downarrow$

::: {.fragment}
Sprawność: $\eta \sim (X_B - X_0)$
:::
::: {.fragment .callout-tip title="Zastosowania" style="font-size: 0.7em;"}
**Suszarnie przemysłowe:** Drewno, zboże, owoce. **Przemysł spożywczy:** Pasta, mąka, mleko w proszku. **Budownictwo:** Suszenie tynków i wylewek.
:::
:::
::: {.column width="65%"}
```{r}
#| label: drying-cycle
#| echo: false
#| fig-width: 9
#| fig-height: 7
#| fig-align: center

# Stany
p0 <- list(x = 8, t = 20)
pA <- list(x = 8, t = 60)
pB <- list(x = 28, t = 28)

p0v <- list(x = p0$x, t = transform_vis(p0$t, p0$x))
pAv <- list(x = pA$x, t = transform_vis(pA$t, pA$x))
pBv <- list(x = pB$x, t = transform_vis(pB$t, pB$x))

# Krzywe RH
rh_levels <- c(0.4, 0.6, 0.8, 1.0)
t_seq <- seq(10, 70, by = 0.5)
df_rh <- do.call(rbind, lapply(rh_levels, function(rh) {
    x_kg <- sapply(t_seq, function(t) get_x_from_rh(t, rh))
    data.frame(t = t_seq, x_g = x_kg * 1000, rh = rh) %>% 
        filter(!is.na(x_g), x_g <= 40) %>%
        mutate(t_vis = transform_vis(t, x_g))
}))

# Izentalpa przez punkt A (h = const)
h_A <- CONSTANTS$cp_dry * pA$t + (pA$x/1000) * (CONSTANTS$r_0 + CONSTANTS$cp_vap * pA$t)
iso_x <- seq(5, 35, by = 1)
iso_t_phys <- (h_A - (iso_x/1000) * CONSTANTS$r_0) / (CONSTANTS$cp_dry + (iso_x/1000) * CONSTANTS$cp_vap)
df_isoH <- data.frame(x_g = iso_x, t_vis = transform_vis(iso_t_phys, iso_x))

ggplot() +
    # Izentalpa
    geom_line(data = df_isoH, aes(x = x_g, y = t_vis), color = "darkgreen", size = 1.2, linetype = "dashed") +
    annotate("text", x = 32, y = df_isoH$t_vis[nrow(df_isoH)] + 2, label = "h = const", color = "darkgreen", size = 6) +
    # Krzywe RH
    geom_line(data = df_rh, aes(x = x_g, y = t_vis, group = rh, color = factor(rh)), size = 1) +
    scale_color_viridis_d(option = "C", direction = -1, name = "φ") +
    # Etap A
    geom_segment(aes(x = p0v$x, y = p0v$t, xend = pAv$x, yend = pAv$t),
                 arrow = arrow(length = unit(0.4, "cm")), color = "red", size = 2) +
    # Etap B
    geom_segment(aes(x = pAv$x, y = pAv$t, xend = pBv$x, yend = pBv$t),
                 arrow = arrow(length = unit(0.4, "cm")), color = "blue", size = 2) +
    # Punkty
    geom_point(aes(x = p0v$x, y = p0v$t), color = "gray30", size = 8) +
    geom_point(aes(x = pAv$x, y = pAv$t), color = "red", size = 8) +
    geom_point(aes(x = pBv$x, y = pBv$t), color = "blue", size = 8) +
    # Etykiety
    annotate("text", x = p0v$x - 1, y = p0v$t, label = "0", color = "gray30", size = 10, fontface = "bold", hjust = 1) +
    annotate("text", x = pAv$x - 1, y = pAv$t, label = "A", color = "red", size = 10, fontface = "bold", hjust = 1) +
    annotate("text", x = pBv$x + 1, y = pBv$t, label = "B", color = "blue", size = 10, fontface = "bold", hjust = 0) +
    # Osie
    scale_x_continuous(limits = c(0, 40), breaks = seq(0, 40, 5)) +
    scale_y_continuous(limits = c(15, 75), breaks = seq(15, 75, 10)) +
    labs(x = "X [g/kg]", y = "t [°C]") +
    theme_minimal(base_size = 22) +
    theme(legend.position = "right") +
    coord_fixed(ratio = 0.5)
```
:::
:::



---

## Nawilżanie Adiabatyczne (Wodą)

::: {.callout-note title="Zasada" appearance="simple" style="font-size: 0.85em;"}
Nawilżanie **wodą** ($h_w \approx 0$) → przemiana **wzdłuż izentalpy** ($\varepsilon \approx 0$). Temperatura spada do $t_m$ (mokry termometr).
:::

::: {.columns}
::: {.column width="35%"}
**Bilans:**

$$ h_1 \approx h_2 $$

::: {.fragment}
Chłodzenie ewaporacyjne!
:::

::: {.fragment .callout-tip title="Zastosowania" style="font-size: 0.7em;"}
**Chłodnie kominowe:** Odprowadzanie ciepła z elektrowni. **Klimatyzatory ewaporacyjne:** Tanie chłodzenie w suchym klimacie. **Przemysł tekstylny:** Nawilżanie hal produkcyjnych.
:::
:::
::: {.column width="65%"}
```{r}
#| label: adiabatic-humidification
#| echo: false
#| fig-width: 9
#| fig-height: 7
#| fig-align: center

# Stany
p1 <- list(x = 8, t = 40)
p2 <- list(x = 22, t = 23)

p1v <- list(x = p1$x, t = transform_vis(p1$t, p1$x))
p2v <- list(x = p2$x, t = transform_vis(p2$t, p2$x))

# Krzywe RH
rh_levels <- c(0.4, 0.6, 0.8, 1.0)
t_seq <- seq(10, 55, by = 0.5)
df_rh <- do.call(rbind, lapply(rh_levels, function(rh) {
    x_kg <- sapply(t_seq, function(t) get_x_from_rh(t, rh))
    data.frame(t = t_seq, x_g = x_kg * 1000, rh = rh) %>% 
        filter(!is.na(x_g), x_g <= 35) %>%
        mutate(t_vis = transform_vis(t, x_g))
}))

# Izentalpa przez punkt 1
h_1 <- CONSTANTS$cp_dry * p1$t + (p1$x/1000) * (CONSTANTS$r_0 + CONSTANTS$cp_vap * p1$t)
iso_x <- seq(5, 30, by = 1)
iso_t_phys <- (h_1 - (iso_x/1000) * CONSTANTS$r_0) / (CONSTANTS$cp_dry + (iso_x/1000) * CONSTANTS$cp_vap)
df_isoH <- data.frame(x_g = iso_x, t_vis = transform_vis(iso_t_phys, iso_x))

ggplot() +
    # Izentalpa
    geom_line(data = df_isoH, aes(x = x_g, y = t_vis), color = "darkgreen", size = 1.2, linetype = "dashed") +
    annotate("text", x = 27, y = df_isoH$t_vis[nrow(df_isoH)] + 2, label = "h = const", color = "darkgreen", size = 6) +
    # Krzywe RH
    geom_line(data = df_rh, aes(x = x_g, y = t_vis, group = rh, color = factor(rh)), size = 1) +
    scale_color_viridis_d(option = "C", direction = -1, name = "φ") +
    # Strzałka przemiany
    geom_segment(aes(x = p1v$x, y = p1v$t, xend = p2v$x, yend = p2v$t),
                 arrow = arrow(length = unit(0.5, "cm")),
                 color = "steelblue", size = 2) +
    # Punkty
    geom_point(aes(x = p1v$x, y = p1v$t), color = "red", size = 8) +
    geom_point(aes(x = p2v$x, y = p2v$t), color = "blue", size = 8) +
    # Etykiety
    annotate("text", x = p1v$x, y = p1v$t + 4, label = "1", color = "red", size = 10, fontface = "bold") +
    annotate("text", x = p2v$x, y = p2v$t - 4, label = "2", color = "blue", size = 10, fontface = "bold") +
    # Osie
    scale_x_continuous(limits = c(0, 35), breaks = seq(0, 35, 5)) +
    scale_y_continuous(limits = c(15, 55), breaks = seq(15, 55, 5)) +
    labs(x = "X [g/kg]", y = "t [°C]") +
    theme_minimal(base_size = 22) +
    theme(legend.position = "right") +
    coord_fixed(ratio = 0.5)
```
:::
:::



---

## Podsumowanie W12

::: {.incremental}
1.  **Wilgotność:** Rozróżniamy względną ($\varphi$, komfort) i bezwzględną ($X$, bilans masy).
2.  **Entalpia:** Para wodna niesie ogromną energię (ciepło utajone).
3.  **Psychrometr:** Różnica temperatur suchego i mokrego pozwala wyznaczyć wilgotność.
4.  **Procesy:** Ogrzewanie obniża $\varphi$, nawilżanie wodne obniża $t$.
:::

### Zadanie Domowe {.fragment}

::: {.fragment .callout-tip title="Zadanie Domowe" style="font-size: 0.9em;"}
Latem ($30^\circ C$) pijesz zimne piwo ($4^\circ C$). Dlaczego butelka "poci się"? Wyjaśnij zjawisko używając pojęcia **Punkt Rosy** i **Ciśnienie Cząstkowe**.
:::
